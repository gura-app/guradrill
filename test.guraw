#!/usr/bin/env gura
# encoding: utf-8
import(wx)
import(cairo)
import(Renderer)

App = class(wx.App) {
	OnInit() = {
		frame = FrameMain('Simple', wx.DefaultPosition, wx.Size(800, 600))
		frame.Show()
		true
	}
}

fontFamilyName = dict {
	`mswin => 'HGMaruGothicMPRO'
	`linux => 'VL Gothic'
	`darwin => 'Hiragino Maru Gothic Pro'
}[sys.platform]

PanelMain = class(wx.Panel) {
	__init__(parent:wx.Window) = {|parent, style => wx.BORDER_SUNKEN|
		this.Bind(wx.EVT_PAINT) {|event| this.OnPaint(event) }
		this.img = image(`rgba, 800, 600)
		this.img.cairo {|cr|
			canvas = Renderer.Canvas(cr)
			//fontFamilyName = 'Monaco'
			fontFamilyName = 'Helvetica'
			//fontFamilyName = 'Geneva'
			canvas.cr.select_font_face(fontFamilyName,
									   cairo.FONT_SLANT_NORMAL, cairo.FONT_WEIGHT_NORMAL)
			canvas.cr.set_font_size(30.0)
			//Renderer.Render(cr, 10, 100, '{3 / 5}[border] / 10')
			canvas.Render(10, 100, '10x + 30 =')
			canvas.Render(10, 150, '(10 + 30) * 5 % 2 - 7 =')
			canvas.Render(10, 200,
						  '{10}[width=3em,left,border] + ' \
						  '{10}[width=3em,center,border] + ' \
						  '{10}[width=3em,right,border]')
			canvas.Render(10, 250, '{10}[width=3em] + {20}[width=3em] = {}[width=3em,border]')
			canvas.Render(10, 300, '{10}[width=3em,border] + {}[width=3em,border] = {}[width=3em,border]')
			canvas.Render(10, 400, '3 / 500 + 2 / 3 - {}[width=3em,border] / 10 =')
			canvas.Render(10, 500, '({3 / 5}[border] / {{1 / 3}[border] + 2 * 4}[border])')
			canvas.Render(400, 100, '3 ^ 4 + 2 ^ {3x + 2}')
			canvas.Render(400, 150, '3x^2 + 4x + 5')
			//canvas.Render(10, 350, '5x + 3 = 0 が成り立つとき、xの値をもとめよ。')
			// [1000]{5c}+[123]{5c}=[]{5b}
		}
		this.bmp = wx.Bitmap(this.img)
	}
	OnPaint(event:wx.PaintEvent) = {
		dc = wx.PaintDC(this)
		this.bmp && dc.DrawBitmap(this.bmp, 0, 0, false)
		dc = nil
	}
}

FrameMain = class(wx.Frame) {
	__init__(title:string, pos:wx.Point, size:wx.Size) = {|nil, wx.ID_ANY, title, pos, size|
		menuBar = wx.MenuBar()
		this.SetMenuBar(menuBar)
		PanelMain(this)
	}
}

wx.IMPLEMENT_APP(App)
